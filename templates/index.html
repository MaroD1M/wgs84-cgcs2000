<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WGS84/CGCS2000åæ ‡è½¬æ¢ä¸ç»çº¬åº¦æ ¼å¼è½¬æ¢å·¥å…·</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .tab-content {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .log-area {
            margin-top: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            height: 200px;
            overflow-y: auto;
            background-color: #f8f9fa;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .result-area {
            min-height: 150px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 10px;
        }
        .table-responsive {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        .batch-controls {
            margin-bottom: 20px;
        }
        .conversion-direction {
            margin-bottom: 25px;
            padding: 15px;
            background-color: #e9f5ff;
            border-radius: 8px;
        }
        .direction-label {
            font-weight: bold;
            margin-right: 15px;
        }
        .input-group {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <h1 class="text-center mb-4">WGS84/CGCS2000åæ ‡è½¬æ¢ä¸ç»çº¬åº¦æ ¼å¼è½¬æ¢å·¥å…·</h1>

    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">å·¥å…·è¯´æ˜</h5>
            <p class="card-text">
                æœ¬å·¥å…·æä¾›WGS84ä¸å›½å®¶2000(CGCS2000)åæ ‡ç³»ç»Ÿçš„åŒå‘è½¬æ¢åŠŸèƒ½ï¼Œ
                æ”¯æŒå•ç‚¹è½¬æ¢å’Œæ‰¹é‡è½¬æ¢ï¼Œå¯å¤„ç†ç»çº¬åº¦ä¸å¤§åœ°åæ ‡ä¹‹é—´çš„è½¬æ¢ã€‚
                åŒæ—¶æ”¯æŒå¤šç§ç»çº¬åº¦æ ¼å¼è½¬æ¢ï¼ˆåè¿›åˆ¶ã€åº¦åˆ†ç§’ã€å‹çŸ¿æ ¼å¼ï¼‰ã€‚
            </p>
        </div>
    </div>

    <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
    <ul class="nav nav-tabs" id="converterTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="single-tab" data-bs-toggle="tab" data-bs-target="#single" type="button" role="tab">å•ç‚¹è½¬æ¢ï¼ˆå¸¸ç”¨ï¼‰</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="batch-tab" data-bs-toggle="tab" data-bs-target="#batch" type="button" role="tab">æ‰¹é‡è½¬æ¢</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="latlng-tab" data-bs-toggle="tab" data-bs-target="#latlng" type="button" role="tab">ç»çº¬åº¦æ ¼å¼è½¬æ¢</button>
        </li>
    </ul>

    <!-- æ ‡ç­¾é¡µå†…å®¹ -->
    <div class="tab-content" id="converterTabsContent">
        <!-- å•ç‚¹è½¬æ¢ -->
        <div class="tab-pane fade show active" id="single" role="tabpanel">
            <!-- è½¬æ¢æ–¹å‘é€‰æ‹© -->
            <div class="conversion-direction">
                <span class="direction-label">è½¬æ¢æ–¹å‘ï¼š</span>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="singleDirection" id="wgs2cgcs" value="wgs2cgcs" checked>
                    <label class="form-check-label" for="wgs2cgcs">WGS84ç»çº¬åº¦ â†’ å›½å®¶2000é«˜æ–¯æŠ•å½±</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="singleDirection" id="cgcs2wgs" value="cgcs2wgs">
                    <label class="form-check-label" for="cgcs2wgs">å›½å®¶2000é«˜æ–¯æŠ•å½± â†’ WGS84ç»çº¬åº¦</label>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <!-- å…¬å…±é…ç½® -->
                    <div class="form-group">
                        <label for="bandTypeSingle" class="form-label fw-bold">åˆ†å¸¦ç±»å‹</label>
                        <select class="form-select" id="bandTypeSingle">
                        <option value="3Â°åˆ†å¸¦" selected>3Â°åˆ†å¸¦ï¼ˆé«˜é¢‘ä½¿ç”¨ï¼‰</option>
                        <option value="6Â°åˆ†å¸¦">6Â°åˆ†å¸¦ï¼ˆä½é¢‘ä½¿ç”¨ï¼‰</option>
                    </select>
                </div>

                <!-- æ–°å¢ï¼šå°æ•°ä½é€‰æ‹© -->
                <div class="form-group">
                    <label for="decimalPlacesSingle" class="form-label fw-bold">å°æ•°ä½æ•° <span class="text-muted" title="è®¾ç½®è½¬æ¢ç»“æœä¿ç•™çš„å°æ•°ä½æ•°ï¼Œé»˜è®¤4ä½">â„¹ï¸</span></label>
                    <select class="form-select" id="decimalPlacesSingle">
                        <option value="1">1ä½</option>
                        <option value="2">2ä½</option>
                        <option value="3">3ä½</option>
                        <option value="4" selected>4ä½</option>
                        <option value="5">5ä½</option>
                        <option value="6">6ä½</option>
                        <option value="7">7ä½</option>
                        <option value="8">8ä½</option>
                    </select>
                </div>

                    <div class="form-group form-check">
                        <input type="checkbox" class="form-check-input" id="withBandSingle">
                        <label class="form-check-label" for="withBandSingle" title="å¯ç”¨åï¼Œå›½å®¶2000é«˜æ–¯æŠ•å½±åæ ‡ç»“æœå°†åŒ…å«å¸¦å·ï¼Œä¾‹å¦‚ï¼š40450000.00ï¼ˆ40å¸¦ï¼‰ï¼Œé€‚ç”¨äºéœ€è¦å¸¦å·æ ‡è¯†çš„GISç³»ç»Ÿ">å¯ç”¨å¸¦å·ï¼ˆé»˜è®¤ä¸å¯ç”¨ï¼‰ <span class="text-muted">â„¹ï¸</span></label>
                    </div>

                    <!-- åŠ¨æ€è¾“å…¥åŒºåŸŸï¼ˆæ ¹æ®è½¬æ¢æ–¹å‘åˆ‡æ¢ï¼‰ -->
                    <div id="wgsInputGroup">
                        <div class="form-group">
                            <label for="longitude" class="form-label">WGS84ç»åº¦ï¼ˆÂ°Eï¼‰ <span class="text-muted" title="èŒƒå›´ï¼š72.0-135.0ï¼Œå›½å†…ç»åº¦èŒƒå›´">â„¹ï¸</span></label>
                            <input type="text" class="form-control" id="longitude" placeholder="ç¤ºä¾‹ï¼š116.397428ï¼ˆåŒ—äº¬å¤©å®‰é—¨ï¼‰">
                        </div>

                        <div class="form-group">
                            <label for="latitude" class="form-label">WGS84çº¬åº¦ï¼ˆÂ°Nï¼‰ <span class="text-muted" title="èŒƒå›´ï¼š0.0-54.0ï¼Œå›½å†…çº¬åº¦èŒƒå›´">â„¹ï¸</span></label>
                            <input type="text" class="form-control" id="latitude" placeholder="ç¤ºä¾‹ï¼š39.909230ï¼ˆåŒ—äº¬å¤©å®‰é—¨ï¼‰">
                        </div>
                    </div>

                    <div id="cgcsInputGroup" style="display: none;">
                        <div class="form-group">
                            <label for="cgcsX" class="form-label">å›½å®¶2000 Xåæ ‡ï¼ˆç±³ï¼‰ <span class="text-muted" title="é«˜æ–¯æŠ•å½±ä¸­çš„æ¨ªåæ ‡">â„¹ï¸</span></label>
                            <input type="text" class="form-control" id="cgcsX" placeholder="ç¤ºä¾‹ï¼š39535156.789ï¼ˆåŒ—äº¬åŒºåŸŸï¼‰">
                        </div>

                        <div class="form-group">
                            <label for="cgcsY" class="form-label">å›½å®¶2000 Yåæ ‡ï¼ˆç±³ï¼‰ <span class="text-muted" title="é«˜æ–¯æŠ•å½±ä¸­çš„çºµåæ ‡">â„¹ï¸</span></label>
                            <input type="text" class="form-control" id="cgcsY" placeholder="ç¤ºä¾‹ï¼š3990923.123ï¼ˆåŒ—äº¬åŒºåŸŸï¼‰">
                        </div>

                        <div class="form-group">
                            <label for="bandNumSingle" class="form-label">å¸¦å·ï¼ˆå¿…å¡«ï¼‰ <span class="text-muted" title="3Â°åˆ†å¸¦èŒƒå›´ï¼š25-45ï¼›6Â°åˆ†å¸¦èŒƒå›´ï¼š13-23">â„¹ï¸</span></label>
                            <input type="text" class="form-control" id="bandNumSingle" placeholder="ç¤ºä¾‹ï¼š38ï¼ˆåŒ—äº¬åŒºåŸŸï¼‰">
                        </div>
                    </div>

                    <div class="form-group text-center">
                        <button class="btn btn-primary btn-lg" id="convertSingleBtn" title="ç‚¹å‡»åæ‰§è¡Œå•ç‚¹åæ ‡è½¬æ¢ï¼Œç»“æœå°†æ˜¾ç¤ºåœ¨å³ä¾§åŒºåŸŸ">æ‰§è¡Œè½¬æ¢</button>
                    </div>
                </div>

                <div class="col-md-6">
                    <h5>è½¬æ¢ç»“æœ</h5>
                    <div class="result-area" id="singleResult">
                        è½¬æ¢ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œï¼Œå¯ç›´æ¥å¤åˆ¶...
                    </div>
                    <div class="text-end text-muted mt-2">
                        âœ… ç»“æœå¯ç›´æ¥å¤åˆ¶ | ğŸ“Œ ä¿ç•™3-6ä½å°æ•°ï¼Œç¡®ä¿ç²¾åº¦
                    </div>
                </div>
            </div>
        </div>

        <!-- æ‰¹é‡è½¬æ¢ -->
        <div class="tab-pane fade" id="batch" role="tabpanel">
            <!-- è½¬æ¢æ–¹å‘é€‰æ‹© -->
            <div class="conversion-direction">
                <span class="direction-label">è½¬æ¢æ–¹å‘ï¼š</span>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="batchDirection" id="batchWgs2cgcs" value="wgs2cgcs" checked>
                    <label class="form-check-label" for="batchWgs2cgcs" title="å°†GPSè·å–çš„WGS84ç»çº¬åº¦è½¬æ¢ä¸ºå›½å®¶2000é«˜æ–¯æŠ•å½±åæ ‡">WGS84ç»çº¬åº¦ â†’ å›½å®¶2000é«˜æ–¯æŠ•å½±</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="batchDirection" id="batchCgcs2wgs" value="cgcs2wgs">
                    <label class="form-check-label" for="batchCgcs2wgs" title="å°†å›½å®¶2000é«˜æ–¯æŠ•å½±åæ ‡è½¬æ¢ä¸ºGPSå¯è¯†åˆ«çš„WGS84ç»çº¬åº¦">å›½å®¶2000é«˜æ–¯æŠ•å½± â†’ WGS84ç»çº¬åº¦</label>
                </div>
            </div>

            <div class="batch-controls">
                <div class="row">
                    <div class="col-md-3">
                        <label for="bandTypeBatch" class="form-label fw-bold">åˆ†å¸¦ç±»å‹ <span class="text-muted" title="3Â°åˆ†å¸¦é€‚ç”¨äºé«˜ç²¾åº¦æµ‹é‡ï¼Œ6Â°åˆ†å¸¦é€‚ç”¨äºå¤§èŒƒå›´åœ°å›¾ç»˜åˆ¶">â„¹ï¸</span></label>
                        <select class="form-select" id="bandTypeBatch">
                        <option value="3Â°åˆ†å¸¦" selected>3Â°åˆ†å¸¦ï¼ˆé«˜é¢‘ä½¿ç”¨ï¼‰</option>
                        <option value="6Â°åˆ†å¸¦">6Â°åˆ†å¸¦ï¼ˆä½é¢‘ä½¿ç”¨ï¼‰</option>
                    </select>
                </div>

                <!-- æ–°å¢ï¼šå°æ•°ä½é€‰æ‹© -->
                <div class="form-group">
                    <label for="decimalPlacesBatch" class="form-label fw-bold">å°æ•°ä½æ•° <span class="text-muted" title="è®¾ç½®è½¬æ¢ç»“æœä¿ç•™çš„å°æ•°ä½æ•°ï¼Œé»˜è®¤4ä½">â„¹ï¸</span></label>
                    <select class="form-select" id="decimalPlacesBatch">
                        <option value="1">1ä½</option>
                        <option value="2">2ä½</option>
                        <option value="3">3ä½</option>
                        <option value="4" selected>4ä½</option>
                        <option value="5">5ä½</option>
                        <option value="6">6ä½</option>
                        <option value="7">7ä½</option>
                        <option value="8">8ä½</option>
                    </select>
                </div>

                    <div class="col-md-2 d-flex align-items-end">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="withBandBatch">
                            <label class="form-check-label" for="withBandBatch" title="å¯ç”¨åï¼Œå›½å®¶2000é«˜æ–¯æŠ•å½±åæ ‡ç»“æœå°†åŒ…å«å¸¦å·ï¼Œä¾‹å¦‚ï¼š40450000.00ï¼ˆ40å¸¦ï¼‰ï¼Œé€‚ç”¨äºéœ€è¦å¸¦å·æ ‡è¯†çš„GISç³»ç»Ÿ">å¯ç”¨å¸¦å· <span class="text-muted">â„¹ï¸</span></label>
                        </div>
                    </div>

                    <div class="col-md-4 d-flex align-items-end">
                        <button class="btn btn-secondary" id="exportTemplateBtn" title="å¯¼å‡ºåŒ…å«æ­£ç¡®åˆ—åçš„ç©ºç™½æ¨¡æ¿ï¼Œæ–¹ä¾¿æ‰¹é‡å¯¼å…¥æ•°æ®">å¯¼å‡ºå‚è€ƒæ¨¡æ¿</button>
                        <select class="form-select ms-2" id="templateType" style="width: auto;">
                            <option value="xlsx">Excel</option>
                            <option value="csv">CSV</option>
                            <option value="txt">TXT</option>
                        </select>
                        <span id="templateHint" class="ms-2 text-muted" title="æ¨¡æ¿åŒ…å«'ç»åº¦'å’Œ'çº¬åº¦'å¿…å¡«åˆ—ï¼Œå¯æ ¹æ®éœ€è¦æ·»åŠ å…¶ä»–åˆ—">ï¼ˆå«ç»åº¦/çº¬åº¦åˆ—ï¼‰</span>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-8">
                        <label for="fileInput" class="form-label">é€‰æ‹©æ•°æ®æ–‡ä»¶ <span class="text-muted" title="æ–‡ä»¶éœ€åŒ…å«'ç»åº¦'å’Œ'çº¬åº¦'åˆ—ï¼Œå…¶ä»–åˆ—ä¼šè¢«ä¿ç•™">â„¹ï¸</span></label>
                        <input type="file" class="form-control" id="fileInput" accept=".xlsx,.csv,.txt" title="æ”¯æŒExcelã€CSVå’Œæ–‡æœ¬æ–‡ä»¶ï¼Œå¤§å°é™åˆ¶ä¸º10MB">
                        <small id="fileHint" class="text-muted">æ”¯æŒ.xlsx/.csv/.txtï¼Œéœ€åŒ…å«'ç»åº¦'/'çº¬åº¦'åˆ—ï¼ˆå¿…å¡«ï¼‰</small>
                    </div>

                    <div class="col-md-4 d-flex align-items-end">
                        <button class="btn btn-primary" id="startBatchBtn" title="ç‚¹å‡»åå¼€å§‹æ‰¹é‡è½¬æ¢æ–‡ä»¶ä¸­çš„æ‰€æœ‰åæ ‡ç‚¹ï¼Œå¤§æ–‡ä»¶å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´">å¼€å§‹æ‰¹é‡è½¬æ¢</button>
                        <button class="btn btn-success ms-2" id="exportResultsBtn" disabled title="è½¬æ¢å®Œæˆåå¯ç”¨ï¼Œå¯¼å‡ºæ‰€æœ‰è½¬æ¢ç»“æœåˆ°æ–‡ä»¶">å¯¼å‡ºè½¬æ¢ç»“æœ</button>
                    </div>
                </div>

                <div class="row mt-2">
                    <div class="col-md-12">
                        <div id="batchStatus" class="text-muted" title="æ˜¾ç¤ºæ‰¹é‡è½¬æ¢çš„å½“å‰çŠ¶æ€ï¼ŒåŒ…æ‹¬æ–‡ä»¶é€‰æ‹©ã€è½¬æ¢è¿›åº¦å’Œå®Œæˆæƒ…å†µ">çŠ¶æ€ï¼šæœªé€‰æ‹©æ–‡ä»¶</div>
                    </div>
                </div>
            </div>

            <h5>è½¬æ¢ç»“æœé¢„è§ˆï¼ˆæœ€å¤šæ˜¾ç¤º50æ¡ï¼‰</h5>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>åºå·</th>
                            <th>è¾“å…¥æ•°æ®</th>
                            <th>è¾“å‡ºç»“æœ</th>
                            <th>è½¬æ¢çŠ¶æ€</th>
                            <th>å¤‡æ³¨</th>
                        </tr>
                    </thead>
                    <tbody id="batchResultsTable">
                        <!-- ç»“æœå°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ç»çº¬åº¦æ ¼å¼è½¬æ¢æ ‡ç­¾é¡µ -->
        <div class="tab-pane fade" id="latlng" role="tabpanel" aria-labelledby="latlng-tab">
            <div class="card mt-3">
                <div class="card-body">
                    <h5>ç»çº¬åº¦æ ¼å¼è½¬æ¢</h5>
                    <p class="text-muted">æ”¯æŒåè¿›åˆ¶æ ¼å¼ä¸åº¦åˆ†ç§’æ ¼å¼ä¹‹é—´çš„ç›¸äº’è½¬æ¢</p>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="form-check">
                        <input class="form-check-input" type="radio" name="latlngConversionType" id="decimalToDms" value="decimalToDms" checked>
                        <label class="form-check-label" for="decimalToDms" title="å°†åè¿›åˆ¶ç»çº¬åº¦ï¼ˆå¦‚116.4074ï¼‰è½¬æ¢ä¸ºåº¦åˆ†ç§’æ ¼å¼ï¼ˆå¦‚116Â°24â€²26.64â€³ï¼‰">
                            åè¿›åˆ¶ â†’ åº¦åˆ†ç§’
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="latlngConversionType" id="dmsToDecimal" value="dmsToDecimal">
                        <label class="form-check-label" for="dmsToDecimal" title="å°†åº¦åˆ†ç§’æ ¼å¼ç»çº¬åº¦ï¼ˆå¦‚116Â°24â€²26.64â€³ï¼‰è½¬æ¢ä¸ºåè¿›åˆ¶ï¼ˆå¦‚116.4074ï¼‰">
                            åº¦åˆ†ç§’ â†’ åè¿›åˆ¶
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="latlngConversionType" id="dmsToMining" value="dmsToMining">
                        <label class="form-check-label" for="dmsToMining" title="å°†åº¦åˆ†ç§’æ ¼å¼ï¼ˆå¦‚35Â°30'40.2516"ï¼‰è½¬æ¢ä¸ºçŸ¿äº§è¡Œä¸šä¸“ç”¨æ ¼å¼ï¼ˆå¦‚35.30402516ï¼‰">
                            åº¦åˆ†ç§’ â†’ å‹çŸ¿æ ¼å¼ï¼ˆå¦‚35Â°30'40.2516" â†’ 35.30402516ï¼‰
                        </label>
                    </div>
                        </div>
                    </div>
                    
                    <!-- å•ç‚¹è½¬æ¢ -->
                    <div class="mt-4">
                        <h6>å•ç‚¹è½¬æ¢</h6>
                        <div class="row">
                            <div class="col-md-5">
                                <div class="mb-3">
                                    <label for="lngInput" class="form-label">ç»åº¦ <span class="text-muted" title="æ”¯æŒåè¿›åˆ¶ã€åº¦åˆ†ç§’æ ¼å¼ï¼Œå¦‚116.4074æˆ–116Â°24â€²26.64â€³">â„¹ï¸</span></label>
                                    <input type="text" class="form-control" id="lngInput" placeholder="ä¾‹å¦‚ï¼š116.4074 æˆ– 116Â°24â€²26.64â€³">
                                </div>
                                <div class="mb-3">
                                    <label for="latInput" class="form-label">çº¬åº¦ <span class="text-muted" title="æ”¯æŒåè¿›åˆ¶ã€åº¦åˆ†ç§’æ ¼å¼ï¼Œå¦‚39.9042æˆ–39Â°54â€²15.12â€³">â„¹ï¸</span></label>
                                    <input type="text" class="form-control" id="latInput" placeholder="ä¾‹å¦‚ï¼š39.9042 æˆ– 39Â°54â€²15.12â€³">
                                </div>
                                <button class="btn btn-primary" id="singleConvertBtn" title="ç‚¹å‡»åè½¬æ¢è¾“å…¥çš„åæ ‡æ ¼å¼ï¼Œç»“æœå°†æ˜¾ç¤ºåœ¨å³ä¾§">è½¬æ¢</button>
                                <button class="btn btn-secondary ms-2" id="clearSingleBtn" title="æ¸…ç©ºç»åº¦å’Œçº¬åº¦è¾“å…¥æ¡†ä¸­çš„å†…å®¹">æ¸…ç©º</button>
                            </div>
                            
                            <div class="col-md-5 offset-md-2">
                                <div class="mb-3">
                                    <label class="form-label" title="æ˜¾ç¤ºæ ¼å¼è½¬æ¢åçš„ç»åº¦å’Œçº¬åº¦ç»“æœ">è½¬æ¢ç»“æœ</label>
                                    <div class="input-group">
                                        <span class="input-group-text" title="æ ¼å¼è½¬æ¢åçš„ç»åº¦å€¼">ç»åº¦</span>
                                        <input type="text" class="form-control" id="lngResult" readonly title="è½¬æ¢åçš„ç»åº¦ç»“æœï¼Œå¯ç›´æ¥å¤åˆ¶">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="input-group">
                                        <span class="input-group-text" title="æ ¼å¼è½¬æ¢åçš„çº¬åº¦å€¼">çº¬åº¦</span>
                                        <input type="text" class="form-control" id="latResult" readonly title="è½¬æ¢åçš„çº¬åº¦ç»“æœï¼Œå¯ç›´æ¥å¤åˆ¶">
                                    </div>
                                </div>
                                <button class="btn btn-success" id="copyResultBtn" title="ä¸€é”®å¤åˆ¶ç»åº¦å’Œçº¬åº¦çš„è½¬æ¢ç»“æœåˆ°å‰ªè´´æ¿">å¤åˆ¶ç»“æœ</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ‰¹é‡è½¬æ¢ -->
                    <div class="mt-4">
                        <h6>æ‰¹é‡è½¬æ¢</h6>
                        <div class="row">
                            <div class="col-md-12">
                                <label for="batchLatLngInput" class="form-label">æ‰¹é‡è¾“å…¥ï¼ˆä¸€è¡Œä¸€ç»„ç»çº¬åº¦ï¼Œçº¬åº¦åœ¨å‰ï¼Œç»åº¦åœ¨åï¼Œç”¨ç©ºæ ¼ã€é€—å·æˆ–åˆ¶è¡¨ç¬¦åˆ†éš”ï¼‰ <span class="text-muted" title="æ”¯æŒå¤šç§æ ¼å¼æ··åˆè¾“å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«">â„¹ï¸</span></label>
                                <textarea class="form-control" id="batchLatLngInput" rows="6" placeholder="ä¾‹å¦‚ï¼š
116.4074,39.9042
121.4737,31.2304
or
116Â°24â€²26.64â€³E,39Â°54â€²15.12â€³N
121Â°28â€²25.32â€³E,31Â°13â€²49.44â€³N" title="æ”¯æŒåè¿›åˆ¶ã€åº¦åˆ†ç§’æ ¼å¼ï¼Œæ¯è¡Œä¸€ç»„åæ ‡"></textarea>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <button class="btn btn-primary" id="batchLatLngConvertBtn" title="ç‚¹å‡»åæ‰¹é‡è½¬æ¢æ‰€æœ‰è¾“å…¥çš„åæ ‡æ ¼å¼">æ‰¹é‡è½¬æ¢</button>
                                <button class="btn btn-secondary ms-2" id="clearBatchLatLngBtn" title="æ¸…ç©ºæ‰¹é‡è¾“å…¥æ–‡æœ¬æ¡†ä¸­çš„æ‰€æœ‰å†…å®¹">æ¸…ç©º</button>
                            </div>
                            <div class="col-md-6 text-end">
                                <button class="btn btn-success" id="exportLatLngResultBtn" disabled title="è½¬æ¢å®Œæˆåå¯ç”¨ï¼Œå¯¼å‡ºæ‰€æœ‰æ ¼å¼è½¬æ¢ç»“æœåˆ°æ–‡ä»¶">å¯¼å‡ºç»“æœ</button>
                            </div>
                        </div>
                        
                        <!-- æ‰¹é‡è½¬æ¢ç»“æœ -->
                        <div class="mt-3">
                            <h6>è½¬æ¢ç»“æœ</h6>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th title="è½¬æ¢é¡ºåºç¼–å·">åºå·</th>
                                            <th title="åŸå§‹è¾“å…¥çš„åæ ‡å€¼">è¾“å…¥</th>
                                            <th title="æ ¼å¼è½¬æ¢åçš„ç»“æœ">ç»“æœ</th>
                                            <th>çŠ¶æ€</th>
                                        </tr>
                                    </thead>
                                    <tbody id="latLngResultsTable">
                                        <!-- ç»“æœå°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ—¥å¿—åŒºåŸŸ -->
    <div class="log-area">
        <h5>æ“ä½œæ—¥å¿—</h5>
        <div id="logContent">
            <div>âœ… ç¨‹åºå¯åŠ¨æˆåŠŸï¼Œæ”¯æŒåŒå‘è½¬æ¢</div>
            <div>ğŸ“Œ æ”¯æŒæ ¼å¼ï¼šExcel(.xlsx)ã€CSV(.csv)ã€TXT(.txt)</div>
            <div>ğŸ”„ è½¬æ¢æ–¹å‘ï¼šWGS84ç»çº¬åº¦ â†” å›½å®¶2000é«˜æ–¯æŠ•å½±</div>
        </div>
        <button class="btn btn-sm btn-outline-secondary mt-2" id="clearLogBtn">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // å…¨å±€å˜é‡å­˜å‚¨ä¸´æ—¶æ–‡ä»¶åç§°å’Œæºç±»å‹
        let tempFileName = null;
        let batchSourceType = 'wgs84';

        // æ·»åŠ æ—¥å¿—
        function addLog(message) {
            const logContent = document.getElementById('logContent');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logContent.appendChild(logEntry);
            logContent.scrollTop = logContent.scrollHeight;
        }

        // æ¸…ç©ºæ—¥å¿—
        document.getElementById('clearLogBtn').addEventListener('click', () => {
            document.getElementById('logContent').innerHTML = '';
            addLog('æ—¥å¿—å·²æ¸…ç©º');
        });

        // ç»çº¬åº¦è½¬æ¢å·¥å…·ç±»
        class LatLngConverter {
            // åè¿›åˆ¶è½¬åº¦åˆ†ç§’
            static decimalToDms(decimal, isLatitude = true, includeDirection = false) {
                const isPositive = decimal >= 0;
                const absDecimal = Math.abs(decimal);
                
                const degrees = Math.floor(absDecimal);
                const minutesDecimal = (absDecimal - degrees) * 60;
                const minutes = Math.floor(minutesDecimal);
                const seconds = (minutesDecimal - minutes) * 60;
                
                const direction = isLatitude ? (isPositive ? 'N' : 'S') : (isPositive ? 'E' : 'W');
                
                return {
                    degrees,
                    minutes,
                    seconds: parseFloat(seconds.toFixed(6)),
                    direction,
                    formatted: includeDirection ? `${degrees}Â°${minutes}'${seconds.toFixed(4)}"${direction}` : `${degrees}Â°${minutes}'${seconds.toFixed(4)}"`
                };
            }
            
            // åº¦åˆ†ç§’è½¬å‹çŸ¿æ ¼å¼ï¼ˆå¦‚35Â°30'40.2516" â†’ 35.30402516ï¼‰
            static dmsToMiningFormat(dmsString, isLatitude = true) {
                try {
                    // å…ˆè½¬æ¢ä¸ºåè¿›åˆ¶ï¼ŒæŒ‡å®šæ˜¯å¦ä¸ºçº¬åº¦
                    const decimal = LatLngConverter.dmsToDecimal(dmsString, isLatitude);
                    // æå–åº¦åˆ†ç§’
                    const dms = LatLngConverter.decimalToDms(Math.abs(decimal));
                    // æ ¼å¼åŒ–ä¸ºåº¦.åˆ†åˆ†ç§’ç§’
                    const miningFormat = `${dms.degrees}.${String(dms.minutes).padStart(2, '0')}${String(Math.floor(dms.seconds)).padStart(2, '0')}${String(dms.seconds).split('.')[1] || '0000'}`;
                    return miningFormat;
                } catch (error) {
                    throw new Error('æ— æ³•è½¬æ¢ä¸ºå‹çŸ¿æ ¼å¼');
                }
            }
            
            // åº¦åˆ†ç§’è½¬åè¿›åˆ¶
            static dmsToDecimal(dmsString, isLatitude = true) {
                // æ”¯æŒå¤šç§æ ¼å¼ï¼š39Â°54â€²15.12â€³N, 39Â°54'15.12"N, 39 54 15.12 N, 39Â°54.252'N
                const dmsRegex = /^\s*([+-]?\d+(?:\.\d+)?)\s*[Â°dD]\s*([+-]?\d+(?:\.\d+)?)\s*['mM]\s*([+-]?\d+(?:\.\d+)?)?\s*["sS]?\s*([NSEWnsew]?)\s*$/;
                const dmsWithSecondsRegex = /^\s*([+-]?\d+(?:\.\d+)?)\s*[Â°dD]\s*([+-]?\d+(?:\.\d+)?)\s*['mM]?\s*([+-]?\d+(?:\.\d+)?)?\s*["sS]?\s*([NSEWnsew]?)\s*$/;
                
                let match = dmsString.match(dmsRegex);
                if (!match) {
                    match = dmsString.match(dmsWithSecondsRegex);
                }
                
                if (!match) {
                    throw new Error('æ— æ³•è§£æåº¦åˆ†ç§’æ ¼å¼');
                }
                
                let [, degrees, minutes, seconds, direction] = match;
                
                // å¦‚æœæ²¡æœ‰ç§’ï¼Œåˆ†é’Ÿå¯èƒ½åŒ…å«å°æ•°éƒ¨åˆ†
                if (!seconds) {
                    seconds = 0;
                } else {
                    seconds = parseFloat(seconds);
                }
                
                degrees = parseFloat(degrees);
                minutes = parseFloat(minutes);
                
                let decimal = Math.abs(degrees) + minutes / 60 + seconds / 3600;
                
                // å¤„ç†æ–¹å‘
                if (direction) {
                    direction = direction.toUpperCase();
                    if ((direction === 'S' || direction === 'W') && degrees >= 0) {
                        decimal = -decimal;
                    } else if ((direction === 'N' || direction === 'E') && degrees < 0) {
                        decimal = Math.abs(decimal);
                    }
                }
                
                // éªŒè¯èŒƒå›´
                if (isLatitude) {
                    if (Math.abs(decimal) > 90) {
                        throw new Error('çº¬åº¦è¶…å‡ºèŒƒå›´ï¼ˆ-90Â° åˆ° 90Â°ï¼‰');
                    }
                } else {
                    if (Math.abs(decimal) > 180) {
                        throw new Error('ç»åº¦è¶…å‡ºèŒƒå›´ï¼ˆ-180Â° åˆ° 180Â°ï¼‰');
                    }
                }
                
                return decimal;
            }
        }
        
        // ç»çº¬åº¦è½¬æ¢åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', () => {
            // å•ç‚¹è½¬æ¢äº‹ä»¶
            document.getElementById('singleConvertBtn').addEventListener('click', () => {
                const lngInput = document.getElementById('lngInput').value.trim();
                const latInput = document.getElementById('latInput').value.trim();
                const conversionType = document.querySelector('input[name="latlngConversionType"]:checked').value;
                
                if (!latInput || !lngInput) {
                    alert('è¯·è¾“å…¥ç»åº¦å’Œçº¬åº¦');
                    return;
                }
                
                try {
                    let latResult, lngResult;
                    
                    if (conversionType === 'decimalToDms') {
                        // åè¿›åˆ¶è½¬åº¦åˆ†ç§’
                        const lngDecimal = parseFloat(lngInput);
                        const latDecimal = parseFloat(latInput);
                        
                        if (isNaN(lngDecimal) || isNaN(latDecimal)) {
                            throw new Error('è¯·è¾“å…¥æœ‰æ•ˆçš„åè¿›åˆ¶æ•°å­—');
                        }
                        
                        const lngDms = LatLngConverter.decimalToDms(lngDecimal, false, false);
                        const latDms = LatLngConverter.decimalToDms(latDecimal, true, false);
                        
                        lngResult = lngDms.formatted;
                        latResult = latDms.formatted;
                        
                        addLog(`ğŸ”„ å•ç‚¹è½¬æ¢å®Œæˆï¼š${lngInput}, ${latInput} â†’ ${lngResult}, ${latResult}`);
                    } else if (conversionType === 'dmsToMining') {
                                // åº¦åˆ†ç§’è½¬å‹çŸ¿æ ¼å¼
                                const lngMining = LatLngConverter.dmsToMiningFormat(lngInput, false);
                                const latMining = LatLngConverter.dmsToMiningFormat(latInput, true);
                                
                                lngResult = lngMining;
                                latResult = latMining;
                        
                        addLog(`ğŸ”„ å•ç‚¹è½¬æ¢å®Œæˆï¼š${lngInput}, ${latInput} â†’ ${lngResult}, ${latResult}`);
                    } else {
                        // åº¦åˆ†ç§’è½¬åè¿›åˆ¶
                        const lngDecimal = LatLngConverter.dmsToDecimal(lngInput, false);
                        const latDecimal = LatLngConverter.dmsToDecimal(latInput, true);
                        
                        lngResult = lngDecimal.toFixed(6);
                        latResult = latDecimal.toFixed(6);
                        
                        addLog(`ğŸ”„ å•ç‚¹è½¬æ¢å®Œæˆï¼š${lngInput}, ${latInput} â†’ ${lngResult}, ${latResult}`);
                    }
                    
                    // æ˜¾ç¤ºç»“æœ
                    document.getElementById('lngResult').value = lngResult;
                    document.getElementById('latResult').value = latResult;
                    
                } catch (error) {
                    alert(`è½¬æ¢å¤±è´¥ï¼š${error.message}`);
                    addLog(`âŒ å•ç‚¹è½¬æ¢å¤±è´¥ï¼š${error.message}`);
                }
            });
            
            // æ¸…ç©ºå•ç‚¹è½¬æ¢
            document.getElementById('clearSingleBtn').addEventListener('click', () => {
                document.getElementById('latInput').value = '';
                document.getElementById('lngInput').value = '';
                document.getElementById('latResult').value = '';
                document.getElementById('lngResult').value = '';
            });
            
            // å¤åˆ¶ç»“æœ
            document.getElementById('copyResultBtn').addEventListener('click', () => {
                const lngResult = document.getElementById('lngResult').value;
                const latResult = document.getElementById('latResult').value;
                
                if (!latResult || !lngResult) {
                    alert('æ²¡æœ‰å¯å¤åˆ¶çš„ç»“æœ');
                    return;
                }
                
                const textToCopy = `${lngResult}, ${latResult}`;
                navigator.clipboard.writeText(textToCopy).then(() => {
                    addLog('ğŸ“‹ è½¬æ¢ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                    // æ˜¾ç¤ºä¸´æ—¶æç¤º
                    const btn = document.getElementById('copyResultBtn');
                    const originalText = btn.textContent;
                    btn.textContent = 'å·²å¤åˆ¶ï¼';
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-primary');
                    
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.classList.remove('btn-primary');
                        btn.classList.add('btn-success');
                    }, 2000);
                }).catch(err => {
                    alert('å¤åˆ¶å¤±è´¥ï¼š' + err);
                });
            });
            
            // æ‰¹é‡è½¬æ¢
            document.getElementById('batchLatLngConvertBtn').addEventListener('click', () => {
                const batchInput = document.getElementById('batchLatLngInput').value.trim();
                const conversionType = document.querySelector('input[name="latlngConversionType"]:checked').value;
                
                if (!batchInput) {
                    alert('è¯·è¾“å…¥æ‰¹é‡è½¬æ¢æ•°æ®');
                    return;
                }
                
                const lines = batchInput.split('\n').filter(line => line.trim());
                const results = [];
                
                lines.forEach((line, index) => {
                    try {
                        // æ”¯æŒç©ºæ ¼ã€é€—å·ã€åˆ¶è¡¨ç¬¦åˆ†éš”
                        const parts = line.trim().split(/[,\s\t]+/).filter(part => part.trim());
                        if (parts.length < 2) {
                            throw new Error('æ¯è¡Œéœ€åŒ…å«ç»åº¦å’Œçº¬åº¦');
                        }
                        
                        const [lngInput, latInput] = parts;
                        let latResult, lngResult;
                        
                        if (conversionType === 'decimalToDms') {
                            // åè¿›åˆ¶è½¬åº¦åˆ†ç§’
                            const lngDecimal = parseFloat(lngInput);
                            const latDecimal = parseFloat(latInput);
                            
                            if (isNaN(lngDecimal) || isNaN(latDecimal)) {
                                throw new Error('è¯·è¾“å…¥æœ‰æ•ˆçš„åè¿›åˆ¶æ•°å­—');
                            }
                            
                            const lngDms = LatLngConverter.decimalToDms(lngDecimal, false, false);
                            const latDms = LatLngConverter.decimalToDms(latDecimal, true, false);
                            
                            lngResult = lngDms.formatted;
                            latResult = latDms.formatted;
                        } else if (conversionType === 'dmsToMining') {
                            // åº¦åˆ†ç§’è½¬å‹çŸ¿æ ¼å¼
                            const lngMining = LatLngConverter.dmsToMiningFormat(lngInput, false);
                            const latMining = LatLngConverter.dmsToMiningFormat(latInput, true);
                            
                            lngResult = lngMining;
                            latResult = latMining;
                        } else {
                            // åº¦åˆ†ç§’è½¬åè¿›åˆ¶
                            const lngDecimal = LatLngConverter.dmsToDecimal(lngInput, false);
                            const latDecimal = LatLngConverter.dmsToDecimal(latInput, true);
                            
                            lngResult = lngDecimal.toFixed(6);
                            latResult = latDecimal.toFixed(6);
                        }
                        
                        results.push({
                            index: index + 1,
                            input: line.trim(),
                            result: `${lngResult}, ${latResult}`,
                            status: 'æˆåŠŸ'
                        });
                        
                    } catch (error) {
                        results.push({
                            index: index + 1,
                            input: line.trim(),
                            result: '',
                            status: 'å¤±è´¥',
                            error: error.message
                        });
                    }
                });
                
                // æ˜¾ç¤ºç»“æœ
                const tableBody = document.getElementById('latLngResultsTable');
                tableBody.innerHTML = '';
                
                results.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.index}</td>
                        <td>${item.input}</td>
                        <td>${item.result}</td>
                        <td class="${item.status === 'æˆåŠŸ' ? 'text-success' : 'text-danger'}">
                            ${item.status}${item.error ? `ï¼š${item.error}` : ''}
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
                
                // å¯ç”¨å¯¼å‡ºæŒ‰é’®
                document.getElementById('exportLatLngResultBtn').disabled = false;
                
                addLog(`ğŸ“Š æ‰¹é‡è½¬æ¢å®Œæˆï¼Œå…±${lines.length}æ¡ï¼ŒæˆåŠŸ${results.filter(r => r.status === 'æˆåŠŸ').length}æ¡`);
            });
            
            // æ¸…ç©ºæ‰¹é‡è½¬æ¢
            document.getElementById('clearBatchLatLngBtn').addEventListener('click', () => {
                document.getElementById('batchLatLngInput').value = '';
                document.getElementById('latLngResultsTable').innerHTML = '';
                document.getElementById('exportLatLngResultBtn').disabled = true;
            });
            
            // å¯¼å‡ºæ‰¹é‡ç»“æœ
            document.getElementById('exportLatLngResultBtn').addEventListener('click', () => {
                const tableBody = document.getElementById('latLngResultsTable');
                const rows = tableBody.querySelectorAll('tr');
                
                if (rows.length === 0) {
                    alert('æ²¡æœ‰å¯å¯¼å‡ºçš„ç»“æœ');
                    return;
                }
                
                // åˆ›å»ºCSVå†…å®¹ï¼Œæ·»åŠ UTF-8 BOMæ ‡è®°ä»¥è§£å†³Windowsä¹±ç é—®é¢˜
                let csvContent = '\uFEFFåºå·,è¾“å…¥,ç»“æœ,çŠ¶æ€\n';
                
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    const rowData = Array.from(cells).map(cell => {
                        const text = cell.textContent.trim();
                        // å¦‚æœåŒ…å«é€—å·æˆ–æ¢è¡Œç¬¦ï¼Œä½¿ç”¨å¼•å·åŒ…è£¹
                        return text.includes(',') || text.includes('\n') ? `"${text.replace(/"/g, '""')}"` : text;
                    });
                    csvContent += rowData.join(',') + '\n';
                });
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥ï¼ŒæŒ‡å®šUTF-8ç¼–ç 
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', `ç»çº¬åº¦è½¬æ¢ç»“æœ_${new Date().getTime()}.csv`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                addLog(`ğŸ“¤ æ‰¹é‡è½¬æ¢ç»“æœå·²å¯¼å‡ºä¸ºCSVæ–‡ä»¶`);
            });
        });

        // å•ç‚¹è½¬æ¢æ–¹å‘åˆ‡æ¢
        const wgs2cgcsRadio = document.getElementById('wgs2cgcs');
        const cgcs2wgsRadio = document.getElementById('cgcs2wgs');
        const wgsInputGroup = document.getElementById('wgsInputGroup');
        const cgcsInputGroup = document.getElementById('cgcsInputGroup');

        wgs2cgcsRadio.addEventListener('change', () => {
            if (wgs2cgcsRadio.checked) {
                wgsInputGroup.style.display = 'block';
                cgcsInputGroup.style.display = 'none';
                addLog('ğŸ”„ è½¬æ¢æ–¹å‘åˆ‡æ¢ä¸ºï¼šWGS84ç»çº¬åº¦ â†’ å›½å®¶2000é«˜æ–¯æŠ•å½±');
            }
        });

        cgcs2wgsRadio.addEventListener('change', () => {
            if (cgcs2wgsRadio.checked) {
                wgsInputGroup.style.display = 'none';
                cgcsInputGroup.style.display = 'block';
                addLog('ğŸ”„ è½¬æ¢æ–¹å‘åˆ‡æ¢ä¸ºï¼šå›½å®¶2000é«˜æ–¯æŠ•å½± â†’ WGS84ç»çº¬åº¦');
            }
        });

        // å•ç‚¹è½¬æ¢
        document.getElementById('convertSingleBtn').addEventListener('click', async () => {
            let sourceType, lonX, latY, bandNum;

            // è·å–è½¬æ¢æ–¹å‘å’Œè¾“å…¥æ•°æ®
            if (wgs2cgcsRadio.checked) {
                sourceType = 'wgs84';
                const longitude = document.getElementById('longitude').value.trim();
                const latitude = document.getElementById('latitude').value.trim();

                if (!longitude || !latitude) {
                    alert('è¯·è¾“å…¥ç»åº¦å’Œçº¬åº¦');
                    return;
                }
                lonX = longitude;
                latY = latitude;
            } else {
                sourceType = 'cgcs2000';
                const cgcsX = document.getElementById('cgcsX').value.trim();
                const cgcsY = document.getElementById('cgcsY').value.trim();
                bandNum = document.getElementById('bandNumSingle').value.trim();

                if (!cgcsX || !cgcsY || !bandNum) {
                    alert('è¯·è¾“å…¥Xåæ ‡ã€Yåæ ‡å’Œå¸¦å·');
                    return;
                }
                lonX = cgcsX;
                latY = cgcsY;
            }

            const bandType = document.getElementById('bandTypeSingle').value;
            const withBand = document.getElementById('withBandSingle').checked;
            const decimalPlaces = parseInt(document.getElementById('decimalPlacesSingle').value);

            try {
                addLog(`å¼€å§‹å•ç‚¹è½¬æ¢ï¼ˆæ–¹å‘ï¼š${sourceType === 'wgs84' ? 'WGS84â†’å›½å®¶2000' : 'å›½å®¶2000â†’WGS84'}ï¼‰`);
                const response = await fetch('/convert_single', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                    sourceType,
                    lonX,
                    latY,
                    bandType,
                    withBand,
                    bandNum,  // ä»…å›½å®¶2000â†’WGS84æ—¶å­˜åœ¨
                    decimalPlaces  // æ–°å¢ï¼šå°æ•°ä½å‚æ•°
                })
                });

                const result = await response.json();

                if (result.status === 'error') {
                    document.getElementById('singleResult').textContent = `é”™è¯¯ï¼š${result.message}`;
                    addLog(`âŒ è½¬æ¢å¤±è´¥ï¼š${result.message}`);
                } else {
                    const data = result.result;
                    let resultText;

                    if (sourceType === 'wgs84') {
                        // WGS84â†’å›½å®¶2000 ç»“æœ
                        resultText = `
è½¬æ¢æˆåŠŸï¼ï¼ˆWGS84â†’å›½å®¶2000ï¼‰
åˆ†å¸¦å·ï¼š${data.band_num}
ä¸­å¤®å­åˆçº¿ï¼š${data.central_lon}Â°
å›½å®¶2000 Xåæ ‡ï¼š${data.x.toFixed(3)} ç±³
å›½å®¶2000 Yåæ ‡ï¼š${data.y.toFixed(3)} ç±³
XYåˆå¹¶ï¼š${data.combined}
                        `.trim();
                    } else {
                        // å›½å®¶2000â†’WGS84 ç»“æœ
                        resultText = `
è½¬æ¢æˆåŠŸï¼ï¼ˆå›½å®¶2000â†’WGS84ï¼‰
åˆ†å¸¦å·ï¼š${data.band_num}
ä¸­å¤®å­åˆçº¿ï¼š${data.central_lon}Â°
WGS84ç»åº¦ï¼š${data.longitude.toFixed(6)} Â°E
WGS84çº¬åº¦ï¼š${data.latitude.toFixed(6)} Â°N
ç»çº¬åº¦åˆå¹¶ï¼š${data.combined}
                        `.trim();
                    }

                    document.getElementById('singleResult').textContent = resultText;
                    addLog(`âœ… å•ç‚¹è½¬æ¢æˆåŠŸï¼šè¾“å…¥=${lonX},${latY} â†’ è¾“å‡º=${data.combined}`);
                }
            } catch (error) {
                document.getElementById('singleResult').textContent = `è½¬æ¢å‡ºé”™ï¼š${error.message}`;
                addLog(`âŒ è½¬æ¢å‡ºé”™ï¼š${error.message}`);
            }
        });

        // æ‰¹é‡è½¬æ¢æ–¹å‘åˆ‡æ¢
        const batchWgs2cgcs = document.getElementById('batchWgs2cgcs');
        const batchCgcs2wgs = document.getElementById('batchCgcs2wgs');
        const templateHint = document.getElementById('templateHint');
        const fileHint = document.getElementById('fileHint');

        batchWgs2cgcs.addEventListener('change', () => {
            if (batchWgs2cgcs.checked) {
                batchSourceType = 'wgs84';
                templateHint.textContent = 'ï¼ˆå«ç»åº¦/çº¬åº¦åˆ—ï¼‰';
                fileHint.textContent = 'æ”¯æŒ.xlsx/.csv/.txtï¼Œéœ€åŒ…å«\'ç»åº¦\'/\'çº¬åº¦\'åˆ—ï¼ˆå¿…å¡«ï¼‰';
                addLog('ğŸ”„ æ‰¹é‡è½¬æ¢æ–¹å‘åˆ‡æ¢ä¸ºï¼šWGS84ç»çº¬åº¦ â†’ å›½å®¶2000é«˜æ–¯æŠ•å½±');
            }
        });

        batchCgcs2wgs.addEventListener('change', () => {
            if (batchCgcs2wgs.checked) {
                batchSourceType = 'cgcs2000';
                templateHint.textContent = 'ï¼ˆå«Xåæ ‡/Yåæ ‡/å¸¦å·åˆ—ï¼‰';
                fileHint.textContent = 'æ”¯æŒ.xlsx/.csv/.txtï¼Œéœ€åŒ…å«\'Xåæ ‡\'/\'Yåæ ‡\'/\'å¸¦å·\'åˆ—ï¼ˆå¿…å¡«ï¼‰';
                addLog('ğŸ”„ æ‰¹é‡è½¬æ¢æ–¹å‘åˆ‡æ¢ä¸ºï¼šå›½å®¶2000é«˜æ–¯æŠ•å½± â†’ WGS84ç»çº¬åº¦');
            }
        });

        // å¯¼å‡ºæ¨¡æ¿
        document.getElementById('exportTemplateBtn').addEventListener('click', () => {
            const templateType = document.getElementById('templateType').value;
            window.location.href = `/export_template?type=${templateType}&source=${batchSourceType}`;
            addLog(`ğŸ“‹ å¯¼å‡º${batchSourceType === 'wgs84' ? 'WGS84â†’å›½å®¶2000' : 'å›½å®¶2000â†’WGS84'}æ ¼å¼æ¨¡æ¿ï¼ˆ${templateType.toUpperCase()}ï¼‰`);
        });

        // æ‰¹é‡è½¬æ¢
        document.getElementById('startBatchBtn').addEventListener('click', async () => {
            const fileInput = document.getElementById('fileInput');
            if (fileInput.files.length === 0) {
                alert('è¯·é€‰æ‹©æ•°æ®æ–‡ä»¶');
                return;
            }

            const bandType = document.getElementById('bandTypeBatch').value;
            const withBand = document.getElementById('withBandBatch').checked;
            const decimalPlaces = document.getElementById('decimalPlacesBatch').value;

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('sourceType', batchSourceType);
            formData.append('bandType', bandType);
            formData.append('withBand', withBand);
            formData.append('decimalPlaces', decimalPlaces);  // æ–°å¢ï¼šå°æ•°ä½å‚æ•°

            try {
                document.getElementById('batchStatus').textContent = 'çŠ¶æ€ï¼šæ­£åœ¨å¤„ç†...';
                addLog(`å¼€å§‹æ‰¹é‡è½¬æ¢ï¼ˆæ–¹å‘ï¼š${batchSourceType === 'wgs84' ? 'WGS84â†’å›½å®¶2000' : 'å›½å®¶2000â†’WGS84'}ï¼‰`);

                const response = await fetch('/convert_batch', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                const tableBody = document.getElementById('batchResultsTable');
                tableBody.innerHTML = '';

                if (result.status === 'error') {
                    document.getElementById('batchStatus').textContent = `çŠ¶æ€ï¼šå¤„ç†å¤±è´¥`;
                    addLog(`âŒ æ‰¹é‡è½¬æ¢å¤±è´¥ï¼š${result.message}`);
                    alert(`å¤„ç†å¤±è´¥ï¼š${result.message}`);
                    return;
                }

                // å¡«å……è¡¨æ ¼
                result.results.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.index}</td>
                        <td>${item.input}</td>
                        <td>${item.output}</td>
                        <td class="${item.status === 'æˆåŠŸ' ? 'text-success' : 'text-danger'}">${item.status}</td>
                        <td>${item.note || item.message}</td>
                    `;
                    tableBody.appendChild(row);
                });

                // æ›´æ–°çŠ¶æ€å’ŒæŒ‰é’®
                tempFileName = result.temp_file;
                document.getElementById('batchStatus').textContent = `çŠ¶æ€ï¼šå¤„ç†å®Œæˆï¼Œå…±${result.total}æ¡è®°å½•`;
                document.getElementById('exportResultsBtn').disabled = false;
                addLog(`âœ… æ‰¹é‡è½¬æ¢å®Œæˆï¼Œå…±å¤„ç†${result.total}æ¡è®°å½•ï¼ˆæˆåŠŸ${result.results.filter(item => item.status === 'æˆåŠŸ').length}æ¡ï¼‰`);
            } catch (error) {
                document.getElementById('batchStatus').textContent = `çŠ¶æ€ï¼šå¤„ç†å‡ºé”™`;
                addLog(`âŒ æ‰¹é‡è½¬æ¢å‡ºé”™ï¼š${error.message}`);
                alert(`å¤„ç†å‡ºé”™ï¼š${error.message}`);
            }
        });

        // å¯¼å‡ºæ‰¹é‡ç»“æœ
        document.getElementById('exportResultsBtn').addEventListener('click', () => {
            if (tempFileName) {
                window.location.href = `/export_results/${tempFileName}`;
                addLog(`ğŸ“‹ å¯¼å‡ºæ‰¹é‡è½¬æ¢ç»“æœï¼ˆæ–¹å‘ï¼š${batchSourceType === 'wgs84' ? 'WGS84â†’å›½å®¶2000' : 'å›½å®¶2000â†’WGS84'}ï¼‰`);
            }
        });
    </script>
</body>
</html>