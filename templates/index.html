<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WGS84 â†” å›½å®¶2000 åŒå‘åæ ‡è½¬æ¢å·¥å…·</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .tab-content {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .log-area {
            margin-top: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            height: 200px;
            overflow-y: auto;
            background-color: #f8f9fa;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .result-area {
            min-height: 150px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 10px;
        }
        .table-responsive {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        .batch-controls {
            margin-bottom: 20px;
        }
        .conversion-direction {
            margin-bottom: 25px;
            padding: 15px;
            background-color: #e9f5ff;
            border-radius: 8px;
        }
        .direction-label {
            font-weight: bold;
            margin-right: 15px;
        }
        .input-group {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <h1 class="text-center mb-4">WGS84ç»çº¬åº¦ â†” å›½å®¶2000é«˜æ–¯æŠ•å½± åŒå‘è½¬æ¢å·¥å…·</h1>

    <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
    <ul class="nav nav-tabs" id="converterTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="single-tab" data-bs-toggle="tab" data-bs-target="#single" type="button" role="tab">å•ç‚¹è½¬æ¢ï¼ˆå¸¸ç”¨ï¼‰</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="batch-tab" data-bs-toggle="tab" data-bs-target="#batch" type="button" role="tab">æ‰¹é‡è½¬æ¢</button>
        </li>
    </ul>

    <!-- æ ‡ç­¾é¡µå†…å®¹ -->
    <div class="tab-content" id="converterTabsContent">
        <!-- å•ç‚¹è½¬æ¢ -->
        <div class="tab-pane fade show active" id="single" role="tabpanel">
            <!-- è½¬æ¢æ–¹å‘é€‰æ‹© -->
            <div class="conversion-direction">
                <span class="direction-label">è½¬æ¢æ–¹å‘ï¼š</span>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="singleDirection" id="wgs2cgcs" value="wgs2cgcs" checked>
                    <label class="form-check-label" for="wgs2cgcs">WGS84ç»çº¬åº¦ â†’ å›½å®¶2000é«˜æ–¯æŠ•å½±</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="singleDirection" id="cgcs2wgs" value="cgcs2wgs">
                    <label class="form-check-label" for="cgcs2wgs">å›½å®¶2000é«˜æ–¯æŠ•å½± â†’ WGS84ç»çº¬åº¦</label>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <!-- å…¬å…±é…ç½® -->
                    <div class="form-group">
                        <label for="bandTypeSingle" class="form-label fw-bold">åˆ†å¸¦ç±»å‹</label>
                        <select class="form-select" id="bandTypeSingle">
                            <option value="3Â°åˆ†å¸¦" selected>3Â°åˆ†å¸¦ï¼ˆé«˜é¢‘ä½¿ç”¨ï¼‰</option>
                            <option value="6Â°åˆ†å¸¦">6Â°åˆ†å¸¦ï¼ˆä½é¢‘ä½¿ç”¨ï¼‰</option>
                        </select>
                    </div>

                    <div class="form-group form-check">
                        <input type="checkbox" class="form-check-input" id="withBandSingle">
                        <label class="form-check-label" for="withBandSingle">å¯ç”¨å¸¦å·ï¼ˆé»˜è®¤ä¸å¯ç”¨ï¼‰</label>
                    </div>

                    <!-- åŠ¨æ€è¾“å…¥åŒºåŸŸï¼ˆæ ¹æ®è½¬æ¢æ–¹å‘åˆ‡æ¢ï¼‰ -->
                    <div id="wgsInputGroup">
                        <div class="form-group">
                            <label for="longitude" class="form-label">WGS84ç»åº¦ï¼ˆÂ°Eï¼‰</label>
                            <input type="text" class="form-control" id="longitude" placeholder="ç¤ºä¾‹ï¼š116.397428ï¼ˆåŒ—äº¬ï¼ŒèŒƒå›´ï¼š72.0-135.0ï¼‰">
                        </div>

                        <div class="form-group">
                            <label for="latitude" class="form-label">WGS84çº¬åº¦ï¼ˆÂ°Nï¼‰</label>
                            <input type="text" class="form-control" id="latitude" placeholder="ç¤ºä¾‹ï¼š39.909230ï¼ˆåŒ—äº¬ï¼ŒèŒƒå›´ï¼š0.0-54.0ï¼‰">
                        </div>
                    </div>

                    <div id="cgcsInputGroup" style="display: none;">
                        <div class="form-group">
                            <label for="cgcsX" class="form-label">å›½å®¶2000 Xåæ ‡ï¼ˆç±³ï¼‰</label>
                            <input type="text" class="form-control" id="cgcsX" placeholder="ç¤ºä¾‹ï¼š39535156.789ï¼ˆåŒ—äº¬åŒºåŸŸï¼‰">
                        </div>

                        <div class="form-group">
                            <label for="cgcsY" class="form-label">å›½å®¶2000 Yåæ ‡ï¼ˆç±³ï¼‰</label>
                            <input type="text" class="form-control" id="cgcsY" placeholder="ç¤ºä¾‹ï¼š3990923.123ï¼ˆåŒ—äº¬åŒºåŸŸï¼‰">
                        </div>

                        <div class="form-group">
                            <label for="bandNumSingle" class="form-label">å¸¦å·ï¼ˆå¿…å¡«ï¼‰</label>
                            <input type="text" class="form-control" id="bandNumSingle" placeholder="ç¤ºä¾‹ï¼š38ï¼ˆ3Â°åˆ†å¸¦ï¼š25-45ï¼›6Â°åˆ†å¸¦ï¼š13-23ï¼‰">
                        </div>
                    </div>

                    <div class="form-group text-center">
                        <button class="btn btn-primary btn-lg" id="convertSingleBtn">æ‰§è¡Œè½¬æ¢</button>
                    </div>
                </div>

                <div class="col-md-6">
                    <h5>è½¬æ¢ç»“æœ</h5>
                    <div class="result-area" id="singleResult">
                        è½¬æ¢ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œï¼Œå¯ç›´æ¥å¤åˆ¶...
                    </div>
                    <div class="text-end text-muted mt-2">
                        âœ… ç»“æœå¯ç›´æ¥å¤åˆ¶ | ğŸ“Œ ä¿ç•™3-6ä½å°æ•°ï¼Œç¡®ä¿ç²¾åº¦
                    </div>
                </div>
            </div>
        </div>

        <!-- æ‰¹é‡è½¬æ¢ -->
        <div class="tab-pane fade" id="batch" role="tabpanel">
            <!-- è½¬æ¢æ–¹å‘é€‰æ‹© -->
            <div class="conversion-direction">
                <span class="direction-label">è½¬æ¢æ–¹å‘ï¼š</span>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="batchDirection" id="batchWgs2cgcs" value="wgs2cgcs" checked>
                    <label class="form-check-label" for="batchWgs2cgcs">WGS84ç»çº¬åº¦ â†’ å›½å®¶2000é«˜æ–¯æŠ•å½±</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="batchDirection" id="batchCgcs2wgs" value="cgcs2wgs">
                    <label class="form-check-label" for="batchCgcs2wgs">å›½å®¶2000é«˜æ–¯æŠ•å½± â†’ WGS84ç»çº¬åº¦</label>
                </div>
            </div>

            <div class="batch-controls">
                <div class="row">
                    <div class="col-md-3">
                        <label for="bandTypeBatch" class="form-label fw-bold">åˆ†å¸¦ç±»å‹</label>
                        <select class="form-select" id="bandTypeBatch">
                            <option value="3Â°åˆ†å¸¦" selected>3Â°åˆ†å¸¦ï¼ˆé«˜é¢‘ä½¿ç”¨ï¼‰</option>
                            <option value="6Â°åˆ†å¸¦">6Â°åˆ†å¸¦ï¼ˆä½é¢‘ä½¿ç”¨ï¼‰</option>
                        </select>
                    </div>

                    <div class="col-md-2 d-flex align-items-end">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="withBandBatch">
                            <label class="form-check-label" for="withBandBatch">å¯ç”¨å¸¦å·</label>
                        </div>
                    </div>

                    <div class="col-md-4 d-flex align-items-end">
                        <button class="btn btn-secondary" id="exportTemplateBtn">å¯¼å‡ºå‚è€ƒæ¨¡æ¿</button>
                        <select class="form-select ms-2" id="templateType" style="width: auto;">
                            <option value="xlsx">Excel</option>
                            <option value="csv">CSV</option>
                            <option value="txt">TXT</option>
                        </select>
                        <span id="templateHint" class="ms-2 text-muted">ï¼ˆå«ç»åº¦/çº¬åº¦åˆ—ï¼‰</span>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-8">
                        <label for="fileInput" class="form-label">é€‰æ‹©æ•°æ®æ–‡ä»¶</label>
                        <input type="file" class="form-control" id="fileInput" accept=".xlsx,.csv,.txt">
                        <small id="fileHint" class="text-muted">æ”¯æŒ.xlsx/.csv/.txtï¼Œéœ€åŒ…å«'ç»åº¦'/'çº¬åº¦'åˆ—ï¼ˆå¿…å¡«ï¼‰</small>
                    </div>

                    <div class="col-md-4 d-flex align-items-end">
                        <button class="btn btn-primary" id="startBatchBtn">å¼€å§‹æ‰¹é‡è½¬æ¢</button>
                        <button class="btn btn-success ms-2" id="exportResultsBtn" disabled>å¯¼å‡ºè½¬æ¢ç»“æœ</button>
                    </div>
                </div>

                <div class="row mt-2">
                    <div class="col-md-12">
                        <div id="batchStatus" class="text-muted">çŠ¶æ€ï¼šæœªé€‰æ‹©æ–‡ä»¶</div>
                    </div>
                </div>
            </div>

            <h5>è½¬æ¢ç»“æœé¢„è§ˆï¼ˆæœ€å¤šæ˜¾ç¤º50æ¡ï¼‰</h5>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>åºå·</th>
                            <th>è¾“å…¥æ•°æ®</th>
                            <th>è¾“å‡ºç»“æœ</th>
                            <th>è½¬æ¢çŠ¶æ€</th>
                            <th>å¤‡æ³¨</th>
                        </tr>
                    </thead>
                    <tbody id="batchResultsTable">
                        <!-- ç»“æœå°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- æ—¥å¿—åŒºåŸŸ -->
    <div class="log-area">
        <h5>æ“ä½œæ—¥å¿—</h5>
        <div id="logContent">
            <div>âœ… ç¨‹åºå¯åŠ¨æˆåŠŸï¼Œæ”¯æŒåŒå‘è½¬æ¢</div>
            <div>ğŸ“Œ æ”¯æŒæ ¼å¼ï¼šExcel(.xlsx)ã€CSV(.csv)ã€TXT(.txt)</div>
            <div>ğŸ”„ è½¬æ¢æ–¹å‘ï¼šWGS84ç»çº¬åº¦ â†” å›½å®¶2000é«˜æ–¯æŠ•å½±</div>
        </div>
        <button class="btn btn-sm btn-outline-secondary mt-2" id="clearLogBtn">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // å…¨å±€å˜é‡å­˜å‚¨ä¸´æ—¶æ–‡ä»¶åç§°å’Œæºç±»å‹
        let tempFileName = null;
        let batchSourceType = 'wgs84';

        // æ·»åŠ æ—¥å¿—
        function addLog(message) {
            const logContent = document.getElementById('logContent');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logContent.appendChild(logEntry);
            logContent.scrollTop = logContent.scrollHeight;
        }

        // æ¸…ç©ºæ—¥å¿—
        document.getElementById('clearLogBtn').addEventListener('click', () => {
            document.getElementById('logContent').innerHTML = '';
            addLog('æ—¥å¿—å·²æ¸…ç©º');
        });

        // å•ç‚¹è½¬æ¢æ–¹å‘åˆ‡æ¢
        const wgs2cgcsRadio = document.getElementById('wgs2cgcs');
        const cgcs2wgsRadio = document.getElementById('cgcs2wgs');
        const wgsInputGroup = document.getElementById('wgsInputGroup');
        const cgcsInputGroup = document.getElementById('cgcsInputGroup');

        wgs2cgcsRadio.addEventListener('change', () => {
            if (wgs2cgcsRadio.checked) {
                wgsInputGroup.style.display = 'block';
                cgcsInputGroup.style.display = 'none';
                addLog('ğŸ”„ è½¬æ¢æ–¹å‘åˆ‡æ¢ä¸ºï¼šWGS84ç»çº¬åº¦ â†’ å›½å®¶2000é«˜æ–¯æŠ•å½±');
            }
        });

        cgcs2wgsRadio.addEventListener('change', () => {
            if (cgcs2wgsRadio.checked) {
                wgsInputGroup.style.display = 'none';
                cgcsInputGroup.style.display = 'block';
                addLog('ğŸ”„ è½¬æ¢æ–¹å‘åˆ‡æ¢ä¸ºï¼šå›½å®¶2000é«˜æ–¯æŠ•å½± â†’ WGS84ç»çº¬åº¦');
            }
        });

        // å•ç‚¹è½¬æ¢
        document.getElementById('convertSingleBtn').addEventListener('click', async () => {
            let sourceType, lonX, latY, bandNum;

            // è·å–è½¬æ¢æ–¹å‘å’Œè¾“å…¥æ•°æ®
            if (wgs2cgcsRadio.checked) {
                sourceType = 'wgs84';
                const longitude = document.getElementById('longitude').value.trim();
                const latitude = document.getElementById('latitude').value.trim();

                if (!longitude || !latitude) {
                    alert('è¯·è¾“å…¥ç»åº¦å’Œçº¬åº¦');
                    return;
                }
                lonX = longitude;
                latY = latitude;
            } else {
                sourceType = 'cgcs2000';
                const cgcsX = document.getElementById('cgcsX').value.trim();
                const cgcsY = document.getElementById('cgcsY').value.trim();
                bandNum = document.getElementById('bandNumSingle').value.trim();

                if (!cgcsX || !cgcsY || !bandNum) {
                    alert('è¯·è¾“å…¥Xåæ ‡ã€Yåæ ‡å’Œå¸¦å·');
                    return;
                }
                lonX = cgcsX;
                latY = cgcsY;
            }

            const bandType = document.getElementById('bandTypeSingle').value;
            const withBand = document.getElementById('withBandSingle').checked;

            try {
                addLog(`å¼€å§‹å•ç‚¹è½¬æ¢ï¼ˆæ–¹å‘ï¼š${sourceType === 'wgs84' ? 'WGS84â†’å›½å®¶2000' : 'å›½å®¶2000â†’WGS84'}ï¼‰`);
                const response = await fetch('/convert_single', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        sourceType,
                        lonX,
                        latY,
                        bandType,
                        withBand,
                        bandNum  // ä»…å›½å®¶2000â†’WGS84æ—¶å­˜åœ¨
                    })
                });

                const result = await response.json();

                if (result.status === 'error') {
                    document.getElementById('singleResult').textContent = `é”™è¯¯ï¼š${result.message}`;
                    addLog(`âŒ è½¬æ¢å¤±è´¥ï¼š${result.message}`);
                } else {
                    const data = result.result;
                    let resultText;

                    if (sourceType === 'wgs84') {
                        // WGS84â†’å›½å®¶2000 ç»“æœ
                        resultText = `
è½¬æ¢æˆåŠŸï¼ï¼ˆWGS84â†’å›½å®¶2000ï¼‰
åˆ†å¸¦å·ï¼š${data.band_num}
ä¸­å¤®å­åˆçº¿ï¼š${data.central_lon}Â°
å›½å®¶2000 Xåæ ‡ï¼š${data.x.toFixed(3)} ç±³
å›½å®¶2000 Yåæ ‡ï¼š${data.y.toFixed(3)} ç±³
XYåˆå¹¶ï¼š${data.combined}
                        `.trim();
                    } else {
                        // å›½å®¶2000â†’WGS84 ç»“æœ
                        resultText = `
è½¬æ¢æˆåŠŸï¼ï¼ˆå›½å®¶2000â†’WGS84ï¼‰
åˆ†å¸¦å·ï¼š${data.band_num}
ä¸­å¤®å­åˆçº¿ï¼š${data.central_lon}Â°
WGS84ç»åº¦ï¼š${data.longitude.toFixed(6)} Â°E
WGS84çº¬åº¦ï¼š${data.latitude.toFixed(6)} Â°N
ç»çº¬åº¦åˆå¹¶ï¼š${data.combined}
                        `.trim();
                    }

                    document.getElementById('singleResult').textContent = resultText;
                    addLog(`âœ… å•ç‚¹è½¬æ¢æˆåŠŸï¼šè¾“å…¥=${lonX},${latY} â†’ è¾“å‡º=${data.combined}`);
                }
            } catch (error) {
                document.getElementById('singleResult').textContent = `è½¬æ¢å‡ºé”™ï¼š${error.message}`;
                addLog(`âŒ è½¬æ¢å‡ºé”™ï¼š${error.message}`);
            }
        });

        // æ‰¹é‡è½¬æ¢æ–¹å‘åˆ‡æ¢
        const batchWgs2cgcs = document.getElementById('batchWgs2cgcs');
        const batchCgcs2wgs = document.getElementById('batchCgcs2wgs');
        const templateHint = document.getElementById('templateHint');
        const fileHint = document.getElementById('fileHint');

        batchWgs2cgcs.addEventListener('change', () => {
            if (batchWgs2cgcs.checked) {
                batchSourceType = 'wgs84';
                templateHint.textContent = 'ï¼ˆå«ç»åº¦/çº¬åº¦åˆ—ï¼‰';
                fileHint.textContent = 'æ”¯æŒ.xlsx/.csv/.txtï¼Œéœ€åŒ…å«\'ç»åº¦\'/\'çº¬åº¦\'åˆ—ï¼ˆå¿…å¡«ï¼‰';
                addLog('ğŸ”„ æ‰¹é‡è½¬æ¢æ–¹å‘åˆ‡æ¢ä¸ºï¼šWGS84ç»çº¬åº¦ â†’ å›½å®¶2000é«˜æ–¯æŠ•å½±');
            }
        });

        batchCgcs2wgs.addEventListener('change', () => {
            if (batchCgcs2wgs.checked) {
                batchSourceType = 'cgcs2000';
                templateHint.textContent = 'ï¼ˆå«Xåæ ‡/Yåæ ‡/å¸¦å·åˆ—ï¼‰';
                fileHint.textContent = 'æ”¯æŒ.xlsx/.csv/.txtï¼Œéœ€åŒ…å«\'Xåæ ‡\'/\'Yåæ ‡\'/\'å¸¦å·\'åˆ—ï¼ˆå¿…å¡«ï¼‰';
                addLog('ğŸ”„ æ‰¹é‡è½¬æ¢æ–¹å‘åˆ‡æ¢ä¸ºï¼šå›½å®¶2000é«˜æ–¯æŠ•å½± â†’ WGS84ç»çº¬åº¦');
            }
        });

        // å¯¼å‡ºæ¨¡æ¿
        document.getElementById('exportTemplateBtn').addEventListener('click', () => {
            const templateType = document.getElementById('templateType').value;
            window.location.href = `/export_template?type=${templateType}&source=${batchSourceType}`;
            addLog(`ğŸ“‹ å¯¼å‡º${batchSourceType === 'wgs84' ? 'WGS84â†’å›½å®¶2000' : 'å›½å®¶2000â†’WGS84'}æ ¼å¼æ¨¡æ¿ï¼ˆ${templateType.toUpperCase()}ï¼‰`);
        });

        // æ‰¹é‡è½¬æ¢
        document.getElementById('startBatchBtn').addEventListener('click', async () => {
            const fileInput = document.getElementById('fileInput');
            if (fileInput.files.length === 0) {
                alert('è¯·é€‰æ‹©æ•°æ®æ–‡ä»¶');
                return;
            }

            const bandType = document.getElementById('bandTypeBatch').value;
            const withBand = document.getElementById('withBandBatch').checked;

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('sourceType', batchSourceType);
            formData.append('bandType', bandType);
            formData.append('withBand', withBand);

            try {
                document.getElementById('batchStatus').textContent = 'çŠ¶æ€ï¼šæ­£åœ¨å¤„ç†...';
                addLog(`å¼€å§‹æ‰¹é‡è½¬æ¢ï¼ˆæ–¹å‘ï¼š${batchSourceType === 'wgs84' ? 'WGS84â†’å›½å®¶2000' : 'å›½å®¶2000â†’WGS84'}ï¼‰`);

                const response = await fetch('/convert_batch', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                const tableBody = document.getElementById('batchResultsTable');
                tableBody.innerHTML = '';

                if (result.status === 'error') {
                    document.getElementById('batchStatus').textContent = `çŠ¶æ€ï¼šå¤„ç†å¤±è´¥`;
                    addLog(`âŒ æ‰¹é‡è½¬æ¢å¤±è´¥ï¼š${result.message}`);
                    alert(`å¤„ç†å¤±è´¥ï¼š${result.message}`);
                    return;
                }

                // å¡«å……è¡¨æ ¼
                result.results.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.index}</td>
                        <td>${item.input}</td>
                        <td>${item.output}</td>
                        <td class="${item.status === 'æˆåŠŸ' ? 'text-success' : 'text-danger'}">${item.status}</td>
                        <td>${item.note || item.message}</td>
                    `;
                    tableBody.appendChild(row);
                });

                // æ›´æ–°çŠ¶æ€å’ŒæŒ‰é’®
                tempFileName = result.temp_file;
                document.getElementById('batchStatus').textContent = `çŠ¶æ€ï¼šå¤„ç†å®Œæˆï¼Œå…±${result.total}æ¡è®°å½•`;
                document.getElementById('exportResultsBtn').disabled = false;
                addLog(`âœ… æ‰¹é‡è½¬æ¢å®Œæˆï¼Œå…±å¤„ç†${result.total}æ¡è®°å½•ï¼ˆæˆåŠŸ${result.results.filter(item => item.status === 'æˆåŠŸ').length}æ¡ï¼‰`);
            } catch (error) {
                document.getElementById('batchStatus').textContent = `çŠ¶æ€ï¼šå¤„ç†å‡ºé”™`;
                addLog(`âŒ æ‰¹é‡è½¬æ¢å‡ºé”™ï¼š${error.message}`);
                alert(`å¤„ç†å‡ºé”™ï¼š${error.message}`);
            }
        });

        // å¯¼å‡ºæ‰¹é‡ç»“æœ
        document.getElementById('exportResultsBtn').addEventListener('click', () => {
            if (tempFileName) {
                window.location.href = `/export_results/${tempFileName}`;
                addLog(`ğŸ“‹ å¯¼å‡ºæ‰¹é‡è½¬æ¢ç»“æœï¼ˆæ–¹å‘ï¼š${batchSourceType === 'wgs84' ? 'WGS84â†’å›½å®¶2000' : 'å›½å®¶2000â†’WGS84'}ï¼‰`);
            }
        });
    </script>
</body>
</html>